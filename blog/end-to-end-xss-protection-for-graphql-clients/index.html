<!DOCTYPE html><html lang="fr-FR" style="
        --primary: #000000;
        --secondary: #ffffff;
        --tertiary: #f00;" data-astro-cid-sckkx6r4=""><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.9.4"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&amp;family=Victor+Mono:ital,wght@0,100..700;1,100..700&amp;display=swap" rel="stylesheet"><title>gwen.works</title><style>main[data-astro-cid-7nsbrrgv]{font-size:1.2rem;line-height:1.5;max-width:80ch;margin:0 auto}main[data-astro-cid-7nsbrrgv] [aria-hidden=true]{display:none}main[data-astro-cid-7nsbrrgv] p:not(:has(img)),ul,dl,ol{max-width:60ch;margin:0 auto}main[data-astro-cid-7nsbrrgv] p:has(img),pre.astro-code{width:100%;max-width:80ch;margin:2em auto}main[data-astro-cid-7nsbrrgv] p>img{width:100%;object-fit:contain;object-position:center}main[data-astro-cid-7nsbrrgv] h1,h2,h3,h4,h5,h6{margin-top:1.5em;margin-bottom:.5em}main[data-astro-cid-7nsbrrgv] pre.astro-code{font-family:Victor Mono,monospace;font-size:.9rem;line-height:1.4;padding:1.2em}
.wip-indicator[data-astro-cid-psqu2qm2]:before{content:"";width:1em;height:1em;border-radius:50%;background:var(--primary, red);display:inline-block}.wip-indicator[data-astro-cid-psqu2qm2]{display:inline-flex;align-items:center;gap:.5ch;font-size:.4em}header[data-astro-cid-rnnefzcs]{display:flex;flex-direction:column;font-size:1.7rem;max-width:60rem}h1[data-astro-cid-rnnefzcs]{font-size:2.8em}a[data-astro-cid-rnnefzcs].back,a[data-astro-cid-rnnefzcs].edit-button{z-index:2;text-decoration:none}section[data-astro-cid-rnnefzcs].links a[data-astro-cid-rnnefzcs]:not(:last-child):before{margin-left:.5em}a[data-astro-cid-rnnefzcs].edit-button{color:transparent;margin-left:1em}a[data-astro-cid-rnnefzcs].edit-button:hover{color:var(--primary, black)}#nav-toggle[data-astro-cid-pux6a34n]{font-size:3rem;cursor:pointer;color:var(--primary, black)}nav[data-astro-cid-pux6a34n]{position:fixed;top:0;right:0;font-size:2rem;z-index:10}ul[data-astro-cid-pux6a34n]{display:flex;flex-direction:column;flex-wrap:wrap;justify-content:center;list-style:none;padding:1rem 2rem;margin:0;gap:.75rem}li[data-astro-cid-pux6a34n]{display:block;text-align:right}li[data-astro-cid-pux6a34n]:before{content:""}a[data-astro-cid-pux6a34n]{font-weight:600;text-decoration:none;opacity:.75;transition:all .125s ease}a[data-astro-cid-pux6a34n]:hover,a[data-astro-cid-pux6a34n]:focus-visible{opacity:1;font-weight:800}@media (max-width: 800px){#nav-toggle[data-astro-cid-pux6a34n]{position:fixed;bottom:0;right:0;width:5rem;height:5rem;z-index:100;padding:.5rem;outline:none;border:none;background-color:var(--secondary, #fff);box-shadow:none;display:flex;justify-content:center;align-items:center}#nav-toggle[data-astro-cid-pux6a34n] .icon[data-astro-cid-pux6a34n]{height:1em;width:1em;color:var(--primary, #000)}nav[data-astro-cid-pux6a34n]#nav:not([data-state=open])>ul[data-astro-cid-pux6a34n]{display:none}nav[data-astro-cid-pux6a34n]#nav[data-state=open]{position:fixed;inset:0;z-index:100;background-color:var(--secondary, #fff);overflow:auto;display:flex;justify-content:end}nav[data-astro-cid-pux6a34n]#nav[data-state=open] ul[data-astro-cid-pux6a34n] a[data-astro-cid-pux6a34n]{font-size:min(12vw,10vh)}nav[data-astro-cid-pux6a34n]#nav[data-state=open] ul[data-astro-cid-pux6a34n]{flex-direction:column-reverse;align-content:center;justify-content:end;margin-right:2rem;margin-bottom:5rem}nav[data-astro-cid-pux6a34n]#nav[data-state=open] ul[data-astro-cid-pux6a34n] li[data-astro-cid-pux6a34n]{padding:0;text-align:right}}@media (min-width: 800px){#nav-toggle[data-astro-cid-pux6a34n]{display:none}main[data-astro-cid-pux6a34n]{padding-top:5rem}}html,body{padding:0;margin:0;width:100%;min-height:100%;font-family:Manrope,sans-serif;color:var(--primary, black);background:var(--secondary, white);line-height:1}body{--pad: 2rem;padding:var(--pad);width:calc(100% - 2 * var(--pad));height:calc(100% - 2 * var(--pad));display:flex;flex-direction:column;gap:2rem}p,p>*{line-height:1.2}ul,li,h1,h2,p{padding:0;margin:0}pre{font-family:inherit;font-size:1em}a:not(.block-link){color:var(--primary, black);text-underline-offset:5px;text-decoration-thickness:1.5px;transition:all .125s}a:not(.block-link):hover,a:not(.block-link):focus-visible{font-weight:700;text-underline-offset:4px;text-decoration-thickness:3px}ul{list-style:none}ul li:before{content:"— ";opacity:.5;font-weight:700}footer[data-astro-cid-sckkx6r4]{margin-top:5rem;display:flex;flex-direction:column;gap:3rem;font-family:Victor Mono,monospace}footer[data-astro-cid-sckkx6r4] ul[data-astro-cid-sckkx6r4]{display:flex;flex-direction:column;gap:.5em;list-style:none;padding:0}footer[data-astro-cid-sckkx6r4] ul[data-astro-cid-sckkx6r4] a[data-astro-cid-sckkx6r4]{white-space:pre}footer[data-astro-cid-sckkx6r4] ul[data-astro-cid-sckkx6r4] .purpose[data-astro-cid-sckkx6r4]{font-style:italic;opacity:.75}footer[data-astro-cid-sckkx6r4] .locals[data-astro-cid-sckkx6r4]{max-width:80vw;white-space:wrap;overflow-x:hidden}
</style></head> <body data-astro-cid-sckkx6r4=""> <script type="module">function l({currentTarget:e}){const t=document.getElementById("nav"),o=e.querySelector(".icon-close"),n=e.querySelector(".icon-open");t.dataset.state==="open"?(document.body.style.overflow="auto",o.style.display="none",n.style.display="block",t.dataset.state="closed"):(document.body.style.overflow="hidden",o.style.display="block",n.style.display="none",t.dataset.state="open")}document.getElementById("nav-toggle").addEventListener("click",e=>{e.currentTarget&&e.currentTarget instanceof HTMLButtonElement&&l(e)});</script> <nav id="nav" data-state="closed" data-astro-cid-pux6a34n=""> <button id="nav-toggle" data-astro-cid-pux6a34n=""><svg class="icon icon-open" width="21" height="21" viewBox="0 0 21 21" fill="none" version="1.1" id="svg4" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" data-astro-cid-pux6a34n=""><rect style="fill:currentColor;stroke:none;stroke-width:1.21228" id="rect267" width="21.059233" height="3.8504581" x="-0.060698148" y="-0.019991903" data-astro-cid-pux6a34n=""></rect> <rect style="fill:currentColor;stroke:none;stroke-width:1.21228" id="rect267-3" width="21.059233" height="3.8504581" x="-0.059473194" y="8.125473" data-astro-cid-pux6a34n=""></rect> <rect style="fill:currentColor;stroke:none;stroke-width:1.21228" id="rect267-3-6" width="21.059233" height="3.8504581" x="-0.058047015" y="17.126282" data-astro-cid-pux6a34n=""></rect></svg> <svg class="icon icon-close" style="display: none;" width="21" height="21" viewBox="0 0 21 21" fill="none" version="1.1" id="svg4" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" data-astro-cid-pux6a34n=""><path style="fill:none;stroke:currentColor;stroke-width:2.92512;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="M 1.1074475,1.058842 19.968611,19.968194" id="path1195" sodipodi:nodetypes="cc" data-astro-cid-pux6a34n=""></path> <path style="fill:none;stroke:currentColor;stroke-width:2.92512;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="M 19.930427,1.0451515 1.0692456,19.954514" id="path1195-6" sodipodi:nodetypes="cc" data-astro-cid-pux6a34n=""></path></svg></button><ul data-astro-cid-pux6a34n=""> <li data-astro-cid-pux6a34n=""> <a href="/" data-astro-cid-pux6a34n="">works</a> </li><li data-astro-cid-pux6a34n=""> <a href="/blog" data-astro-cid-pux6a34n="">blog</a> </li><li data-astro-cid-pux6a34n=""> <a href="/design" data-astro-cid-pux6a34n="">design</a> </li><li data-astro-cid-pux6a34n=""> <a href="/music" data-astro-cid-pux6a34n="">music</a> </li><li data-astro-cid-pux6a34n=""> <a href="/software" data-astro-cid-pux6a34n="">code</a> </li><li data-astro-cid-pux6a34n=""> <a href="/contact" data-astro-cid-pux6a34n="">contact</a> </li><li data-astro-cid-pux6a34n=""> <a href="https://en.gwen.works/" data-astro-cid-pux6a34n="">in english</a> </li> </ul> </nav>   <script type="module">document.querySelector("#edit")&&window.addEventListener("keypress",e=>{e.key==="e"&&(window.location.href=document.querySelector("#edit").href)});</script> <header data-astro-cid-rnnefzcs=""> <section class="links" data-astro-cid-rnnefzcs=""> <a class="back" href="/blog" data-astro-cid-rnnefzcs="">
&lt;- retour </a> <a id="edit" class="edit-button" href="vscode://file/C:/Users/ewen/projects.local/portfolio/blog/end-to-end-xss-protection-for-graphql-clients.md" title="edit (if you're me only :3)" data-astro-cid-rnnefzcs="">
/ed
</a> </section> <h1 data-astro-cid-rnnefzcs=""> End-to-end XSS protection for GraphQL clients <sup class="wip-indicator" data-astro-cid-psqu2qm2=""> <abbr title="Work In Progress" data-astro-cid-psqu2qm2="">WIP</abbr> </sup>  </h1>  <p data-astro-cid-7nsbrrgv=""> <span data-astro-cid-7nsbrrgv="">publié le</span> <time datetime="2024-08-04T00:00:00.000Z" data-astro-cid-7nsbrrgv=""> 4 août 2024 </time> </p>  </header>  <main data-astro-cid-7nsbrrgv=""><p>There you are, accepting Markdown content from your users, and exposing on your API a field that resolves to a XSS-safe HTML rendering of that user-generated content.</p>
<p>This is good, you’re following best practices and preventing XSS. Or are you?</p>
<p>As you turn around to your client code, you get that generated HTML <em>string</em>, and include it somewhere on your page, telling your templating engin / js framework “it’s fine, this is safe for HTML inclusion”.</p>
<p>A few months pass, you add more and more features, and suddenly your API has _a lot_of fields, some that output HTML and some that output plain text.</p>
<p>As a documentation feature, you create a separate <code>HTML</code> scalar type to signal fields that have HTML content (and thus cannot be inserted into the page as simple text).</p>
<p>But we can get way better than that: <em>end-to-end guarantees</em> of XSS safety, courtesy of type systems.</p>
<h2 id="the-recipe">The recipe</h2>
<ol>
<li>Define a separate scalar type for HTML content on your GraphQL API: we’ll call it <code>HTML</code>.</li>
<li>On your client, create an <a href="https://en.wikipedia.org/wiki/Opaque_data_type">Opaque type</a> that wraps a string, such that no string value can be assigned to that opaque type, but data of that type can be assigned to a string.</li>
<li>Bind the <code>HTML</code> scalar type to the opaque type on your client.</li>
<li>Create a component that accepts a value of the opaque type, and includes the HTML value without escaping</li>
<li>(bonus) Enforce that no other place on your frontend code is allowed to include HTML without escaping.</li>
</ol>
<h3 id="example-with-typescript-and">Example with Typescript and</h3>
<h4 id="houdini-part">Houdini part</h4></main>  <footer data-astro-cid-sckkx6r4=""> <p data-astro-cid-sckkx6r4="">
made with <a href="/ortfo" data-astro-cid-sckkx6r4="">ortfo/db</a> &amp; <a href="https://astro.build" data-astro-cid-sckkx6r4="">astro</a> </p> <p data-astro-cid-sckkx6r4="">&lt;3 Gwenn 2025</p> <p data-astro-cid-sckkx6r4="">generative ai cannot make art</p> <ul data-astro-cid-sckkx6r4="">  <li data-astro-cid-sckkx6r4=""> <a href="https://open.spotify.com/artist/6tUc6r8aNeiiT1mElcnMx9?si=yCM83yThR4WVCkC4Kd5p7Q" data-astro-cid-sckkx6r4="">/to/spotify    </a> <span class="purpose" data-astro-cid-sckkx6r4="">my music</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="https://music.apple.com/fr/artist/ewen-lbh/1506892811" data-astro-cid-sckkx6r4="">/to/applemusic </a> <span class="purpose" data-astro-cid-sckkx6r4="">my music</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="https://bsky.app/profile/gwen.works" data-astro-cid-sckkx6r4="">/to/bluesky    </a> <span class="purpose" data-astro-cid-sckkx6r4="">random thoughts</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="https://github.com/gwennlbh" data-astro-cid-sckkx6r4="">/to/github     </a> <span class="purpose" data-astro-cid-sckkx6r4="">open-source code</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="https://youtube.com/@postamble" data-astro-cid-sckkx6r4="">/to/youtube    </a> <span class="purpose" data-astro-cid-sckkx6r4="">visual+music</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="https://deezer.page.link/keZbR1mRNyp5ba6W9" data-astro-cid-sckkx6r4="">/to/deezer     </a> <span class="purpose" data-astro-cid-sckkx6r4="">my music</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="mailto:gwenn.lebihan7@gmail.com" data-astro-cid-sckkx6r4="">/to/mail       </a> <span class="purpose" data-astro-cid-sckkx6r4="">contact</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="https://instagram.com/gwen_lbh" data-astro-cid-sckkx6r4="">/to/instagram  </a> <span class="purpose" data-astro-cid-sckkx6r4="">multimedia work</span> </li>  <li data-astro-cid-sckkx6r4=""> <a href="https://linkedin.com/in/gwennlbh" data-astro-cid-sckkx6r4="">/to/linkedin   </a> <span class="purpose" data-astro-cid-sckkx6r4="">my carreer</span> </li>  </ul> <pre class="locals" data-astro-cid-sckkx6r4="">{
  "lang": "fr",
  "locale": "fr-FR",
  "buildCommit": "<a href="https://github.com/gwennlbh/portfolio/commit/f0de5392cd59663155cac552a4c980eb09b320aa">f0de5392</a>"
}</pre> </footer>  </body></html>